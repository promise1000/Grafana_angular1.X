{"version":3,"sources":["../src/progressbar_ctrl.js"],"names":["MetricsPanelCtrl","_","kbn","TimeSeries","rendering","ProgressBarCtrl","$scope","$injector","$rootScope","hiddenSeries","panelDefaults","links","datasource","interval","targets","cacheTimeout","nullPointMode","aliasColors","format","valueName","strokeWidth","fontSize","combine","threshold","label","middleFont","colors","dataPoint","adjFontSize","FontSize","bars","data","dataName","thresholdsValue","thresholdstmp","minValue","maxValue","postfix","prefix","barHeight","bH","shape","currentShape","SliderSize","SliderS","sliderColor","barColor","max","min","thresholds","value","decimals","valueDecimals","datanames","default","fontCalc","text","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","Math","random","toString","slice","addEditorTab","unitFormats","getUnitFormats","series","render","color","alias","parseSeries","map","serie","i","stats","subItem","dataList","seriesHandler","sort","seriesData","datapoints","target","flotpairs","getFlotPairs","isNumber","scaledDecimals","delta","dec","floor","log","LN10","magn","pow","norm","size","result","toFixed","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","randomStr","substring","substr","refresh","key","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","file":"progressbar_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport _ from 'lodash';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport rendering from './rendering';\r\n\r\nexport class ProgressBarCtrl extends MetricsPanelCtrl {\r\n\r\n  constructor($scope, $injector, $rootScope) {\r\n    super($scope, $injector);\r\n    this.$rootScope = $rootScope;\r\n    this.hiddenSeries = {};\r\n    // panel的默认值\r\n    var panelDefaults = {\r\n      links: [],\r\n      datasource: null,\r\n      interval: null,\r\n      targets: [{}],\r\n      cacheTimeout: null,\r\n      // 这是什么字段啊？连接的！\r\n      nullPointMode: 'connected',\r\n      aliasColors: {},\r\n      format: 'short',\r\n      valueName: 'current',\r\n      strokeWidth: 1,\r\n      fontSize: '80%',\r\n      combine: {\r\n        threshold: 0.0,\r\n        label: 'Others'\r\n      },\r\n      middleFont: 15,\r\n      colors: ['rgba(12, 201, 12, 0.9)', 'rgba(255, 183, 0, 0.89)', 'rgba(255, 35, 30, 0.97)'],\r\n      dataPoint: [],\r\n      adjFontSize: true,\r\n      FontSize: '70%',\r\n      bars: [{\r\n        label: '',\r\n        data: null,\r\n        dataName: null,\r\n        thresholdsValue: '30,60',\r\n        thresholdstmp: [],\r\n        minValue: 0,\r\n        maxValue: 100,\r\n        postfix: ' ',\r\n        prefix: ' ',\r\n      }],\r\n      // bar config\r\n      barHeight:['75%','100%','125%'],\r\n      bH:'100%',\r\n      shape: ['triangle','rectangle','circle'],\r\n      currentShape: 'rectangle',\r\n      SliderSize: ['75%','100%','125%'],\r\n      SliderS:'100%',\r\n      sliderColor:'rgba(12, 201, 12, 0.9)',\r\n      // 给出固定的八个渐变的颜色\r\n      barColor: [\"rgba(12, 201, 12, 0.9)\",\"rgba(255, 183, 0, 0.89)\",\"rgba(255, 35, 30, 0.97)\",\"rgb(255,85,0)\",\"rgb(255,85,0)\",\"rgb(114,160,193)\",\"rgb(121,114,193)\"]\r\n    };\r\n    // 初始化bar对象\r\n    this.bars = {}\r\n    this.bars['pH (0~14)'] = {\r\n      label:[\"rgba(12, 201, 12, 0.9)\",\"rgba(255, 183, 0, 0.89)\",\"rgba(255, 35, 30, 0.97)\"],\r\n      max:\"14\",\r\n      min:'0',\r\n      prefix:\" \",\r\n      postfix:\" \",\r\n      thresholds:\"6,8\",\r\n      value:'7.5',\r\n      decimals: 2\r\n    }\r\n    this.bars['DO (0~50 mg/L)'] = {\r\n        label:[\"rgba(12, 201, 12, 0.9)\",\"rgba(255, 183, 0, 0.89)\",\"rgba(255, 35, 30, 0.97)\"],\r\n        max:\"75\",\r\n        min:'0',\r\n        prefix:\" \",\r\n        postfix:\"mg/L\",\r\n        thresholds:\"25,50\",\r\n        value:'30',\r\n        valueDecimals:\" \",\r\n        decimals: 2\r\n      }\r\n    this.datanames = {\r\n      default: ''\r\n    };\r\n    this.adjFontSize = true;\r\n    this.fontSize = '0.8vw';\r\n    // this.fontSizes = ['80%', '90%', '100%', '110%', '120%', '130%', '150%', '160%', '180%', '200%', '220%', '250%'];\r\n    this.fontCalc = [\r\n      {\r\n        text: '60%',\r\n        value: '0.6vw'\r\n      },\r\n      {\r\n        text: '70%',\r\n        value: '0.8vw'\r\n      },\r\n      {\r\n        text: '80%',\r\n        value: '1vw'\r\n      },\r\n      {\r\n        text: '100%',\r\n        value: '1.4vw'\r\n      },\r\n      {\r\n        text: '110%',\r\n        value: '1.6vw'\r\n      },\r\n      {\r\n        text: '120%',\r\n        value: '1.8vw'\r\n      },\r\n      {\r\n        text: '130%',\r\n        value: '2vw'\r\n      },\r\n      {\r\n        text: '140%',\r\n        value: '2.2vw'\r\n      },\r\n      {\r\n        text: '150%',\r\n        value: '2.4vw'\r\n      },\r\n      {\r\n        text: '160%',\r\n        value: '2.6vw'\r\n      },\r\n      {\r\n        text: '180%',\r\n        value: '3vw'\r\n      },\r\n      {\r\n        text: '200%',\r\n        value: '3.4vw'\r\n      },\r\n      {\r\n        text: '220%',\r\n        value: '3.8vw'\r\n      },\r\n      {\r\n        text: '230%',\r\n        value: '4vw'\r\n      },\r\n    ];\r\n\r\n    _.defaults(this.panel, panelDefaults);\r\n    this.events.on('render', this.onRender.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n  }\r\n  // 生成随机色\r\n  randomColor () { \r\n    return '#' + ('00000' + (Math.random() * 0x1000000 << 0).toString(16)).slice( - 6);\r\n  }\r\n  onInitEditMode() {\r\n    this.addEditorTab('WISE-PaaS', 'public/plugins/progress-bar-panel/SRP.html', 2);\r\n    this.unitFormats = kbn.getUnitFormats();\r\n  }\r\n\r\n  onDataError() {\r\n    this.series = [];\r\n    this.render();\r\n  }\r\n\r\n  changeSeriesColor(series, color) {\r\n    series.color = color;\r\n    this.panel.aliasColors[series.alias] = series.color;\r\n    this.render();\r\n  }\r\n\r\n  onRender() {\r\n    this.data = this.parseSeries(this.series);\r\n  }\r\n\r\n  parseSeries(series) {\r\n    return _.map(this.series, (serie, i) => {\r\n      return {\r\n        label: serie.alias,\r\n        data: serie.stats[this.panel.valueName],\r\n        color: this.panel.aliasColors[serie.alias] || this.$rootScope.colors[i]\r\n      };\r\n    });\r\n  }\r\n\r\n  setUnitFormat(subItem) {\r\n    this.panel.format = subItem.value;\r\n    this.render();\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    this.series = dataList.map(this.seriesHandler.bind(this));\r\n    this.data = this.parseSeries(this.series);\r\n    this.panel.dataPoint = _.map(this.data, 'label').sort();\r\n    this.render(this.data);\r\n  }\r\n\r\n  seriesHandler(seriesData) {\r\n    var series = new TimeSeries({\r\n      datapoints: seriesData.datapoints,\r\n      alias: seriesData.target\r\n    });\r\n\r\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\r\n    return series;\r\n  }\r\n\r\n  getDecimalsForValue(value) {\r\n    if (_.isNumber(this.panel.decimals)) {\r\n      return { decimals: this.panel.decimals, scaledDecimals: null };\r\n    }\r\n\r\n    var delta = value / 2;\r\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\r\n\r\n    var magn = Math.pow(10, -dec);\r\n    var norm = delta / magn; // norm is between 1.0 and 10.0\r\n    var size;\r\n\r\n    if (norm < 1.5) {\r\n      size = 1;\r\n    } else if (norm < 3) {\r\n      size = 2;\r\n      // special case for 2.5, requires an extra decimal\r\n      if (norm > 2.25) {\r\n        size = 2.5;\r\n        ++dec;\r\n      }\r\n    } else if (norm < 7.5) {\r\n      size = 5;\r\n    } else {\r\n      size = 10;\r\n    }\r\n\r\n    size *= magn;\r\n\r\n    // reduce starting decimals if not needed\r\n    if (Math.floor(value) === value) { dec = 0; }\r\n\r\n    var result = {};\r\n    result.decimals = Math.max(0, dec);\r\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\r\n\r\n    return result;\r\n  }\r\n\r\n  formatValue(value) {\r\n    if (this.panel.format === 'short') {\r\n      if (_.isNumber(this.panel.decimals)){\r\n        return value.toFixed(this.panel.decimals)\r\n      }else{\r\n        return value\r\n      }\r\n    }\r\n    var decimalInfo = this.getDecimalsForValue(value);\r\n    var formatFunc = kbn.valueFormats[this.panel.format];\r\n    if (formatFunc) {\r\n      return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n    }\r\n    return value;\r\n  }\r\n  // 添加一个配置面板\r\n  addBar(){\r\n    // 生成随机串作为每个barsetting的唯一标识\r\n    let randomStr = (Math.random().toString(36) + Math.random().toString(36).substring(2)).substr(2, Math.floor(Math.random() * (31 - 19) + 20))\r\n    this.datanames[randomStr] = ''\r\n    this.refresh();\r\n  }\r\n  // 移除一个配置面板\r\n  removeBar(key){\r\n   delete this.datanames[key]\r\n   this.refresh();\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    // 导入的link函数，并调用\r\n    rendering(scope, elem, attrs, ctrl);\r\n  }\r\n\r\n  toggleSeries(serie) {\r\n    if (this.hiddenSeries[serie.label]) {\r\n      delete this.hiddenSeries[serie.alias];\r\n    } else {\r\n      this.hiddenSeries[serie.label] = true;\r\n    }\r\n    this.render();\r\n  }\r\n}\r\n\r\nProgressBarCtrl.templateUrl = 'module.html';\r\n"]}